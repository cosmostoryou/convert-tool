<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>ç¹ç°¡è½‰æ›å·¥å…·</title>
  <meta name="robots" content="noindex, nofollow">
  <script src="./opencc-full.js"></script>
  <style>
    :root {
      --bg-light: #f9f9f9;
      --bg-dark: #1e1e1e;
      --text-light: #333;
      --text-dark: #eee;
      --box-light: #f0f0f0;
      --box-dark: #2c2c2c;
    }
    body {
      font-family: sans-serif;
      padding: 2em;
      background-color: var(--bg-light);
      color: var(--text-light);
      max-width: 720px;
      margin: auto;
      transition: all 0.3s ease;
    }
    body.dark {
      background-color: var(--bg-dark);
      color: var(--text-dark);
    }
    textarea {
      width: 100%;
      padding: 1em;
      font-size: 1em;
      border: 1px solid #ccc;
      border-radius: 8px;
      box-sizing: border-box;
      resize: vertical;
      background-color: white;
    }
    body.dark textarea {
      background-color: #333;
      color: #eee;
      border: 1px solid #555;
    }
    button {
      margin-top: 1em;
      margin-right: 1em;
      padding: 0.5em 1.2em;
      font-size: 1em;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      background-color: #111;
      color: #fff;
    }
    pre {
      white-space: pre-wrap;
      word-wrap: break-word;
      background-color: var(--box-light);
      padding: 1em;
      border-radius: 8px;
      margin-top: 1em;
      min-height: 3em;
    }
    body.dark pre {
      background-color: var(--box-dark);
      color: var(--text-dark);
    }
    #loading {
      margin-bottom: 1em;
      font-size: 0.95em;
      color: #888;
    }
  </style>
</head>
<body>
  <h2>ç¹ç°¡è½‰æ›å·¥å…·</h2>

  <div id="loading">ğŸ”„ æ­£åœ¨åˆå§‹åŒ– OpenCCï¼Œè«‹ç¨å€™...</div>

  <textarea id="inputText" rows="6" placeholder="è«‹è¼¸å…¥è¦è½‰æ›çš„æ–‡å­—..."></textarea>

  <div>
    <button onclick="convertToSimplified()">è½‰ç‚ºç°¡é«”</button>
    <button onclick="convertToTraditional()">è½‰ç‚ºç¹é«”</button>
    <button onclick="copyResult()">ğŸ” è¤‡è£½çµæœ</button>
    <button onclick="clearAll()">ğŸ“‹ æ¸…ç©º</button>
    <button onclick="toggleTheme()">â˜€ï¸ğŸŒ™ åˆ‡æ›ä¸»é¡Œ</button>
  </div>

  <h3>è½‰æ›çµæœï¼š</h3>
  <pre id="output">ï¼ˆé€™è£¡æœƒé¡¯ç¤ºè½‰æ›å¾Œçš„æ–‡å­—ï¼‰</pre>

  <script>
    let toCN, toTW;
    let isReady = false;

    const customPairs = [
      ['ã€Œ', 'â€œ'], ['ã€', 'â€'],
      ['è’™æ ¼', 'èŠ’æ ¼'], ['è¯å€«', 'æ²ƒä¼¦'],
      ['ç­å‚‘æ˜Â·è‘›æ‹‰æ¼¢', 'æœ¬æ°æ˜Â·æ ¼é›·å„å§†'],
      ['æ³¢å…‹å¤', 'ä¼¯å…‹å¸Œå°”'], ['æµ·ç‘Ÿå¨', 'å“ˆæ’’éŸ¦'],
      ['è¯å€«Â·å·´è²ç‰¹', 'æ²ƒä¼¦Â·å·´è²ç‰¹'],
      ['æ³¢å…‹å¤Â·æµ·ç‘Ÿå¨', 'ä¼¯å…‹å¸Œå°”Â·å“ˆæ’’éŸ¦'],
        ['çŸ­å½±éŸ³', 'çŸ­è§†é¢‘'],
      ['ç¤¾ç¾¤åª’é«”', 'ç¤¾äº¤åª’ä½“'],
       ['ç¤¾ç¾¤å¹³å°', 'ç¤¾äº¤å¹³å°']
    ];

    
    const preserveTerms = ['æ™ºæ…§', 'æ™ºèƒ½'];

    function maskPreserveTerms(text) {
      let masked = text;
      preserveTerms.forEach((term, i) => {
        masked = masked.replaceAll(term, `__PRESERVE_${i}__`);
      });
      return masked;
    }

    function unmaskPreserveTerms(text) {
      let unmasked = text;
      preserveTerms.forEach((term, i) => {
        unmasked = unmasked.replaceAll(`__PRESERVE_${i}__`, term);
      });
      return unmasked;
    }

    const contextSensitivePairs = [
      ['äººå·¥æ™ºæ…§', 'äººå·¥æ™ºèƒ½'],
      ['é€šç”¨äººå·¥æ™ºæ…§', 'é€šç”¨äººå·¥æ™ºèƒ½']
    ];

    function applyContextSensitive(text, toSimplified = true) {
      let result = text;
      for (const [tw, cn] of contextSensitivePairs) {
        result = result.replaceAll(toSimplified ? tw : cn, toSimplified ? cn : tw);
      }
      return result;
    }


    function applyCustom(text, toSimplified = true) {
      let result = text;
      for (const [tw, cn] of customPairs) {
        result = result.replaceAll(toSimplified ? tw : cn, toSimplified ? cn : tw);
      }
      return result;
    }

    async function initOpenCC() {
      toCN = await OpenCC.Converter({ from: 'twp', to: 'cn' });
      toTW = await OpenCC.Converter({ from: 'cn', to: 'twp' });
      isReady = true;
      document.getElementById('loading').style.display = 'none';
      console.log("âœ… OpenCC åˆå§‹åŒ–å®Œæˆ");
    }

    initOpenCC();

    async function waitUntilReady() {
      while (!isReady) {
        await new Promise(resolve => setTimeout(resolve, 50));
      }
    }

    async function convertToSimplified() {
      await waitUntilReady();
      const input = document.getElementById('inputText').value;
      const step0 = applyContextSensitive(input, true);
      const step1 = maskPreserveTerms(step0);
      const step2 = applyCustom(step1, true);
      const converted = await toCN(step2);
      const result = unmaskPreserveTerms(converted);
      document.getElementById('output').textContent = result;
    }

    async function convertToTraditional() {
      await waitUntilReady();
      const input = document.getElementById('inputText').value;
      const step0 = applyContextSensitive(input, false);
      const step1 = maskPreserveTerms(step0);
      const step2 = applyCustom(step1, false);
      const converted = await toTW(step2);
      const result = unmaskPreserveTerms(converted);
      document.getElementById('output').textContent = result;
    }

    function copyResult() {
      const output = document.getElementById('output').textContent;
      navigator.clipboard.writeText(output).then(() => {
        alert("âœ… å·²è¤‡è£½è½‰æ›çµæœï¼");
      });
    }

    function clearAll() {
      document.getElementById('inputText').value = '';
      document.getElementById('output').textContent = '';
    }

    function toggleTheme() {
      document.body.classList.toggle('dark');
    }
  </script>
</body>
</html>
