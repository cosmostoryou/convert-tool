<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>è¨€é€‰å¡ç‰‡æœº - ç¼©æ”¾é¢„è§ˆå¤šè¡Œæ’ç‰ˆ</title>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1">
    function convertTabs() {
      const inputArea = document.getElementById('textInput');
      const converted = inputArea.value.replace(/\t/g, ',');
      inputArea.value = converted;
      alert('å·²è½‰æ›ç‚ºé€—è™Ÿåˆ†éš”æ ¼å¼ï¼Œå¯ç›´æ¥ç”Ÿæˆå¡ç‰‡ï¼');
    }
    </script>
  <script src="https://cdn.jsdelivr.net/npm/jszip@3.7.1/dist/jszip.min.js">
    function convertTabs() {
      const inputArea = document.getElementById('textInput');
      const converted = inputArea.value.replace(/\t/g, ',');
      inputArea.value = converted;
      alert('å·²è½‰æ›ç‚ºé€—è™Ÿåˆ†éš”æ ¼å¼ï¼Œå¯ç›´æ¥ç”Ÿæˆå¡ç‰‡ï¼');
    }
    </script>
  <script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js">
    function convertTabs() {
      const inputArea = document.getElementById('textInput');
      const converted = inputArea.value.replace(/\t/g, ',');
      inputArea.value = converted;
      alert('å·²è½‰æ›ç‚ºé€—è™Ÿåˆ†éš”æ ¼å¼ï¼Œå¯ç›´æ¥ç”Ÿæˆå¡ç‰‡ï¼');
    }
    </script>
  <style>
    @font-face {
      font-family: 'HuiwenMincho';
      src: url('Huiwenmincho.ttf');
    }
    body {
      font-family: sans-serif;
      display: flex;
      gap: 40px;
      align-items: flex-start;
      padding: 20px;
    }
    .settings {
      width: 360px;
      flex-shrink: 0;
    }
    textarea {
      width: 100%;
      height: 400px;
      resize: vertical;
    }
    .preview-area {
      flex-grow: 1;
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
    }
    .preview-wrapper {
      width: 300px;
      height: 300px;
      overflow: hidden;
      position: relative;
    }
    .card {
      width: 900px;
      height: 900px;
      background-size: cover;
      background-position: center;
      position: relative;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      padding: 60px;
      white-space: pre-line;
      color: #222;
      font-size: 36px;
      line-height: 1.5;
      transform: scale(0.33);
      transform-origin: top left;
    }
    .quote-text {
      margin-bottom: 0.6em;
    }
    .author {
      font-size: 27px;
      color: #444;
      letter-spacing: 0.05em;
      margin-top: 12px;
    }
    .bottom-url {
      position: absolute;
      bottom: 30px;
      left: 0;
      right: 0;
      text-align: center;
      font-size: 14px;
      color: #999;
      font-family: Georgia, serif;
    }
  </style>
</head>
<body>
  <div class="settings">
    <h2>ğŸ“œ è¨€é€‰å¡ç‰‡æœº</h2>

    <textarea id="textInput" placeholder="æ¯æ®µæ ¼å¼ï¼šè¯­å½•,ä½œè€… 
\n æ¢è¡Œä¹¦å†™ 
ï¼Œã€‚ï¼›ä¼šæ¢è¡Œ
##ï¼Œ ä¸ºä¸æ¢è¡Œ"></textarea><br><br>

    <label>ä¸Šä¼ èƒŒæ™¯å›¾ï¼š</label>
    <input type="file" id="bgUpload" accept="image/*"><br><br>

    <label>ä¸Šä¼ è‡ªå®šä¹‰å­—ä½“ï¼ˆ.ttfï¼‰ï¼š</label>
    <input type="file" id="fontUpload" accept=".ttf"><br><br>

    <label>å­—ä½“åç§°ï¼š</label>
    <input type="text" id="fontName" value="HuiwenMincho"><br><br>

    <label>å­—å·ï¼š</label>
    <input type="number" id="fontSize" value="55"> pxã€€
    <label>è¡Œè·ï¼š</label>
    <input type="number" id="lineHeight" value="1.5" step="0.1"><br><br>

    <label>ç½‘å€æ˜¾ç¤ºï¼š</label>
    <input type="text" id="siteUrl" value="SuperLifeOS.com"><br><br>

    <button onclick="convertTabs()">å°‡ Notion è¤‡è£½æ ¼å¼è½‰ç‚ºé€—è™Ÿæ ¼å¼</button><br><br>
    <button onclick="generateCards()">ç”Ÿæˆå¡ç‰‡</button>
    <button onclick="downloadAll()">æ‰“åŒ…ä¸‹è½½</button>
  </div>

  <div id="previewArea" class="preview-area"></div>

  <script>
    let bgUrl = 'paper.jpg'; // é è¨­èƒŒæ™¯åœ–ç‰‡ï¼Œè«‹ç¢ºä¿å·²ä¸Šå‚³ paper.jpg è‡³åŒä¸€ç›®éŒ„";
    let customFont = 'HuiwenMincho';
    let lastQuotes = [];

    document.getElementById('bgUpload').addEventListener('change', e => {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = ev => { bgUrl = ev.target.result; };
        reader.readAsDataURL(file);
      }
    });

    document.getElementById('fontUpload').addEventListener('change', e => {
      const file = e.target.files[0];
      const reader = new FileReader();
      reader.onload = ev => {
        customFont = file.name.split('.')[0];
        document.getElementById('fontName').value = customFont;
        const style = document.createElement('style');
        style.innerHTML = `@font-face { font-family: '${customFont}'; src: url('${ev.target.result}'); }`;
        document.head.appendChild(style);
        alert('å­—ä½“å·²åŠ è½½ï¼š' + customFont);
      };
      reader.readAsDataURL(file);
    });

    function parseInput() {
      return document.getElementById('textInput').value.trim().split(/\n+/).map(line => {
        const [quote, author] = line.split(',');
        return {
          quote: (quote || '').trim().replace(/##ï¼Œ/g, '##comma').replace(/[ï¼Œã€‚ï¼›]/g, '$&<br>').replace(/##comma/g, 'ï¼Œ'),
          author: author ? author.trim() : ''
        };
      }).filter(q => q.quote);
    }

    function generateCards() {
      const preview = document.getElementById('previewArea');
      preview.innerHTML = '';

      const font = document.getElementById('fontName').value;
      const size = document.getElementById('fontSize').value;
      const lh = document.getElementById('lineHeight').value;
      const site = document.getElementById('siteUrl').value;
      const quotes = parseInput();
      lastQuotes = quotes;

      quotes.forEach((q, i) => {
        const wrapper = document.createElement('div');
        wrapper.className = 'preview-wrapper';

        const div = document.createElement('div');
        div.className = 'card';
        div.id = `card-${i}`;
        div.style.fontFamily = font;
        div.style.fontSize = `${size}px`;
        div.style.lineHeight = lh;
        div.style.backgroundImage = `url('${bgUrl}')`;
        div.innerHTML = `
          <div class="quote-text">${q.quote.replace(/\\n/g, '<br>')}</div>
          ${q.author ? `<div class="author">${q.author}</div>` : ''}
          <div class="bottom-url">${site}</div>
        `;

        wrapper.appendChild(div);
        preview.appendChild(wrapper);
      });
    }

    async function downloadAll() {
      const zip = new JSZip();
      const cards = document.querySelectorAll('.card');

      for (let i = 0; i < cards.length; i++) {
        await new Promise(r => setTimeout(r, 500));
        const canvas = await html2canvas(cards[i], { useCORS: true, scale: 3 });
        const blob = await new Promise(res => canvas.toBlob(res));
        if (!blob) {
          alert(`ç¬¬ ${i + 1} å¼ å›¾åƒç”Ÿæˆå¤±è´¥ï¼Œè¯·æ£€æŸ¥å­—ä½“æˆ–èƒŒæ™¯å›¾åŠ è½½æ˜¯å¦å®Œæˆ`);
          continue;
        }
        const cleanAuthor = (lastQuotes[i].author || 'unknown').replace(/[\\/:*?"<>|\n]/g, '').trim();
        const cleanHead = lastQuotes[i].quote.slice(0, 3).replace(/[\\/:*?"<>|\n]/g, '').trim();
        zip.file(`${cleanAuthor}_${cleanHead || 'quote_' + (i + 1)}.png`, blob);
      }
      zip.generateAsync({ type: 'blob' }).then(content => {
        saveAs(content, 'quote_cards.zip');
      });
    }
  
    function convertTabs() {
      const inputArea = document.getElementById('textInput');
      const converted = inputArea.value.replace(/\t/g, ',');
      inputArea.value = converted;
      alert('å·²è½‰æ›ç‚ºé€—è™Ÿåˆ†éš”æ ¼å¼ï¼Œå¯ç›´æ¥ç”Ÿæˆå¡ç‰‡ï¼');
    }
    </script>
</body>
</html>
