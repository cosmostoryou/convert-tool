<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>èªéŒ„æ··æ’å·¥å…·</title>
  <style>
    body { font-family: sans-serif; padding: 20px; max-width: 960px; margin: auto; }
    textarea { width: 100%; height: 240px; margin-bottom: 1em; font-family: monospace; }
    button { padding: 8px 20px; margin-bottom: 1em; }
    pre { background: #f7f7f7; padding: 10px; white-space: pre-wrap; }
  </style>
</head>
<body>
  <h2>ğŸ“… èªéŒ„æ··æ’å·¥å…·</h2>
  <p>è«‹è²¼ä¸ŠèªéŒ„æ¸…å–®ï¼Œæ¯è¡Œæ ¼å¼ï¼š<code>èªéŒ„,ä½œè€…,ä¸»é¡Œ,åºè™Ÿ</code>ï¼ˆåºè™Ÿå¯ç©ºï¼‰ï¼Œç³»çµ±æœƒé¿å…äººç‰©èˆ‡ä¸»é¡Œé‡è¤‡å‡ºç¾å¤ªè¿‘ã€‚</p>
  <button onclick="convertTabs()">å°‡ Notion è¤‡è£½æ ¼å¼è½‰ç‚ºé€—è™Ÿæ ¼å¼</button>
  <br><br>
  <textarea id="input" placeholder="æˆç‚ºä½ è‡ªå·±ã€‚,å°¼é‡‡,æˆé•·\näººç”Ÿè€Œè‡ªç”±ï¼Œå»ç„¡å¾€ä¸åœ¨æ·é–ã€‚,ç›§æ¢­,è‡ªç”±\n..."></textarea>
  <button onclick="shuffleQuotes()">ç”Ÿæˆæ··æ’çµæœ</button>
  <button onclick="exportCSV()">ä¸‹è¼‰ CSV</button>
  <a id="downloadLink" style="display:none"></a>
  <h3>ğŸ“¤ çµæœï¼š</h3>
  <pre id="output"></pre>

  <script>
    function shuffleQuotes() {
      const input = document.getElementById('input').value.trim();
      const lines = input.split('\n').map(line => {
        
      const [quote, author, topic, index] = line.split(',');
      return { quote: quote?.trim(), author: author?.trim(), topic: topic?.trim(), index: index?.trim() };
    
        return { quote: quote?.trim(), author: author?.trim(), topic: topic?.trim() };
      }).filter(q => q.quote && q.author && q.topic);

      const result = [];
      const usedAuthors = new Set();
      const usedTopics = new Set();

      while (lines.length) {
        let found = false;
        for (let i = 0; i < lines.length; i++) {
          const q = lines[i];
          if (!usedAuthors.has(q.author) && !usedTopics.has(q.topic)) {
            result.push(q);
            usedAuthors.add(q.author);
            usedTopics.add(q.topic);
            lines.splice(i, 1);
            found = true;
            break;
          }
        }
        if (!found) {
          usedAuthors.clear();
          usedTopics.clear();
        }
      }

      const startDate = new Date();
      const linesOut = result.map((q, i) => {
        const date = new Date(startDate);
        date.setDate(date.getDate() + i);
        const dateStr = date.toISOString().split('T')[0];
        return `${dateStr}ï½œ${q.index || ''}ï½œ${q.quote}ï½œ${q.author}ï½œ${q.topic}`;
      });

      document.getElementById('output').textContent = linesOut.join('\n');
    }
  
    function convertTabs() {
      const inputArea = document.getElementById('input');
      const converted = inputArea.value.replace(/\t/g, ',');
      inputArea.value = converted;
      alert('å·²è½‰æ›ç‚ºé€—è™Ÿåˆ†éš”æ ¼å¼ï¼Œå¯ç›´æ¥æ··æ’ï¼');
    }
    
    function exportCSV() {
      const output = document.getElementById('output').textContent.trim();
      if (!output) return alert('è«‹å…ˆç”Ÿæˆæ··æ’çµæœ');
      const csv = ['æ—¥æœŸ,åºè™Ÿ,èªéŒ„,ä½œè€…,ä¸»é¡Œ'];
      output.split('\n').forEach(line => {
        const [date, index, quote, author, topic] = line.split('ï½œ');
        const row = [date, index, quote, author, topic].map(s => `"${s?.replace(/"/g, '""')}"`).join(',');
        csv.push(row);
      });
      const bom = '\uFEFF';
      const blob = new Blob([bom + csv.join('\n')], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const link = document.getElementById('downloadLink');
      link.setAttribute('href', url);
      link.setAttribute('download', 'èªéŒ„æ··æ’.csv');
      link.click();
    }
    </script>
</body>
</html>
